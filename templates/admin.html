<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="\DazeHotel\static\admin.css">
</head>
<body>
    <header>
        <img src="\DazeHotel\static\img\logo.png" alt="Logo del Dazevalleyhotel" style="width: 200px; height: auto;" />
        <h1>Panel de Administración </h1>
    </header>
    <main>
        <section id="dashboard" class="dashboard">
            <div class="card">
                <h2>Resumen</h2>
                <p>Habitaciones ocupadas: <span id="ocupacion">15/30</span></p>
                <p>Reservas pendientes: <span id="reservas-pendientes">5</span></p>
                <p>Ingresos del día: <span id="ingresos">$1,500</span></p>
            </div>
            <div class="card">
                <h2>Acciones rápidas</h2>
                <button id="nueva-reserva">Nueva reserva</button>
                <button id="nueva-habitacion">Nueva habitación</button>
            </div>
        </section>
        <section id="reservas">
            <h2>Reservas</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Cliente</th>
                        <th>Habitación</th>
                        <th>Fecha de entrada</th>
                        <th>Fecha de salida</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="reservas-tabla">
                    <!-- Las filas se llenarán con JavaScript -->
                </tbody>
            </table>
        </section>
        <section id="habitaciones">
            <h2>Habitaciones</h2>
            <table>
                <thead>
                    <tr>
                        <th>Número</th>
                        <th>Tipo</th>
                        <th>Capacidad</th>
                        <th>Estado</th>
                        <th>Precio por noche</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="habitaciones-tabla">
                    <!-- Las filas se llenarán con JavaScript -->
                </tbody>
            </table>
        </section>
    </main>

    <!-- Modal para Reservas -->
    <div id="reserva-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="reserva-modal-titulo">Nueva Reserva</h2>
            <form id="reserva-form">
                <input type="hidden" id="reserva-id">
                <label for="reserva-cliente">Cliente:</label>
                <input type="text" id="reserva-cliente" required>
                <label for="reserva-habitacion">Habitación:</label>
                <input type="number" id="reserva-habitacion" required>
                <label for="reserva-fecha-entrada">Fecha de entrada:</label>
                <input type="date" id="reserva-fecha-entrada" required>
                <label for="reserva-fecha-salida">Fecha de salida:</label>
                <input type="date" id="reserva-fecha-salida" required>
                <label for="reserva-estado">Estado:</label>
                <select id="reserva-estado" required>
                    <option value="Confirmada">Confirmada</option>
                    <option value="Pendiente">Pendiente</option>
                    <option value="Cancelada">Cancelada</option>
                </select>
                <button type="submit">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Modal para Habitaciones -->
    <div id="habitacion-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="habitacion-modal-titulo">Nueva Habitación</h2>
            <form id="habitacion-form">
                <label for="habitacion-numero">Número:</label>
                <input type="number" id="habitacion-numero" required>
                <label for="habitacion-tipo">Tipo:</label>
                <input type="text" id="habitacion-tipo" required>
                <label for="habitacion-capacidad">Capacidad:</label>
                <input type="number" id="habitacion-capacidad" required>
                <label for="habitacion-estado">Estado:</label>
                <select id="habitacion-estado" required>
                    <option value="Disponible">Disponible</option>
                    <option value="Ocupada">Ocupada</option>
                    <option value="Mantenimiento">Mantenimiento</option>
                </select>
                <label for="habitacion-precio">Precio por noche:</label>
                <input type="number" id="habitacion-precio" required>
                <button type="submit">Guardar</button>
            </form>
        </div>
    </div>

    <script>
        // Datos de ejemplo
        let reservas = [
            { id: 1, cliente: 'Juan Pérez', habitacion: 101, fechaEntrada: '2023-05-01', fechaSalida: '2023-05-05', estado: 'Confirmada' },
            { id: 2, cliente: 'María García', habitacion: 205, fechaEntrada: '2023-05-03', fechaSalida: '2023-05-07', estado: 'Pendiente' },
        ];

        let habitaciones = [
            { numero: 101, tipo: 'Individual', capacidad: 1, estado: 'Ocupada', precio: 80 },
            { numero: 205, tipo: 'Doble', capacidad: 2, estado: 'Disponible', precio: 120 },
        ];

        // Función para llenar la tabla de reservas
        function llenarTablaReservas() {
            const tabla = document.getElementById('reservas-tabla');
            tabla.innerHTML = '';

            // Ordena las reservas por ID
            reservas.sort((a, b) => a.id - b.id);

            // Reasigna IDs consecutivos
            reservas.forEach((reserva, index) => {
                reserva.id = index + 1;
            });

            reservas.forEach(reserva => {
                const fila = `
                    <tr>
                        <td>${reserva.id}</td>
                        <td>${reserva.cliente}</td>
                        <td>${reserva.habitacion}</td>
                        <td>${reserva.fechaEntrada}</td>
                        <td>${reserva.fechaSalida}</td>
                        <td>${reserva.estado}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editarReserva(${reserva.id})">Editar</button>
                            <button class="action-btn delete-btn" onclick="eliminarReserva(${reserva.id})">Eliminar</button>
                        </td>
                    </tr>
                `;
                tabla.innerHTML += fila;
            });
        }

        // Función para llenar la tabla de habitaciones
        function llenarTablaHabitaciones() {
            const tabla = document.getElementById('habitaciones-tabla');
            tabla.innerHTML = '';
            habitaciones.forEach(habitacion => {
                const fila = `
                    <tr>
                        <td>${habitacion.numero}</td>
                        <td>${habitacion.tipo}</td>
                        <td>${habitacion.capacidad}</td>
                        <td>${habitacion.estado}</td>
                        <td>$${habitacion.precio}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editarHabitacion(${habitacion.numero})">Editar</button>
                            <button class="action-btn delete-btn" onclick="eliminarHabitacion(${habitacion.numero})">Eliminar</button>
                        </td>
                    </tr>
                `;
                tabla.innerHTML += fila;
            });
        }

        // Función para actualizar el dashboard
        function actualizarDashboard() {
            const habitacionesOcupadas = habitaciones.filter(h => h.estado === 'Ocupada').length;
            const totalHabitaciones = habitaciones.length;
            const reservasPendientes = reservas.filter(r => r.estado === 'Pendiente').length;
            const ingresosDelDia = reservas.reduce((total, reserva) => {
                const habitacion = habitaciones.find(h => h.numero === reserva.habitacion);
                return total + (habitacion ? habitacion.precio : 0);
            }, 0);

            document.getElementById('ocupacion').textContent = `${habitacionesOcupadas}/${totalHabitaciones}`;
            document.getElementById('reservas-pendientes').textContent = reservasPendientes;
            document.getElementById('ingresos').textContent = `$${ingresosDelDia}`;
        }

        // Funciones para manejar reservas
        function mostrarFormularioReserva(reserva = null) {
            const modal = document.getElementById('reserva-modal');
            const form = document.getElementById('reserva-form');
            const titulo = document.getElementById('reserva-modal-titulo');

            if (reserva) {
                titulo.textContent = 'Editar Reserva';
                document.getElementById('reserva-id').value = reserva.id;
                document.getElementById('reserva-cliente').value = reserva.cliente;
                document.getElementById('reserva-habitacion').value = reserva.habitacion;
                document.getElementById('reserva-fecha-entrada').value = reserva.fechaEntrada;
                document.getElementById('reserva-fecha-salida').value = reserva.fechaSalida;
                document.getElementById('reserva-estado').value = reserva.estado;
            } else {
                titulo.textContent = 'Nueva Reserva';
                form.reset();
                document.getElementById('reserva-id').value = '';
            }

            modal.style.display = 'block';
        }

        function guardarReserva(event) {
            event.preventDefault();
            const form = event.target;
            const reserva = {
                id: form.querySelector('#reserva-id').value ? parseInt(form.querySelector('#reserva-id').value) : reservas.length + 1,
                cliente: form.querySelector('#reserva-cliente').value,
                habitacion: parseInt(form.querySelector('#reserva-habitacion').value),
                fechaEntrada: form.querySelector('#reserva-fecha-entrada').value,
                fechaSalida: form.querySelector('#reserva-fecha-salida').value,
                estado: form.querySelector('#reserva-estado').value
            };

            const index = reservas.findIndex(r => r.id == reserva.id);
            if (index !== -1) {
                reservas[index] = reserva;
            } else {
                reservas.push(reserva);
            }

            document.getElementById('reserva-modal').style.display = 'none';
            llenarTablaReservas();
            actualizarDashboard();
        }

        function editarReserva(id) {
            const reserva = reservas.find(r => r.id == id);
            if (reserva) {
                mostrarFormularioReserva(reserva);
            }
        }

        function eliminarReserva(id) {
            if (confirm('¿Estás seguro de que quieres eliminar esta reserva?')) {
                reservas = reservas.filter(r => r.id != id);
                llenarTablaReservas();
                actualizarDashboard();
            }
        }

        // Funciones para manejar habitaciones
        function mostrarFormularioHabitacion(habitacion = null) {
            const modal = document.getElementById('habitacion-modal');
            const form = document.getElementById('habitacion-form');
            const titulo = document.getElementById('habitacion-modal-titulo');

            if (habitacion) {
                titulo.textContent = 'Editar Habitación';
                document.getElementById('habitacion-numero').value = habitacion.numero;
                document.getElementById('habitacion-tipo').value = habitacion.tipo;
                document.getElementById('habitacion-capacidad').value = habitacion.capacidad;
                document.getElementById('habitacion-estado').value = habitacion.estado;
                document.getElementById('habitacion-precio').value = habitacion.precio;
            } else {
                titulo.textContent = 'Nueva Habitación';
                form.reset();
            }

            modal.style.display = 'block';
        }

        function guardarHabitacion(event) {
            event.preventDefault();
            const form = event.target;
            const habitacion = {
                numero: parseInt(form.querySelector('#habitacion-numero').value),
                tipo: form.querySelector('#habitacion-tipo').value,
                capacidad: parseInt(form.querySelector('#habitacion-capacidad').value),
                estado: form.querySelector('#habitacion-estado').value,
                precio: parseFloat(form.querySelector('#habitacion-precio').value)
            };

            const index = habitaciones.findIndex(h => h.numero == habitacion.numero);
            if (index !== -1) {
                habitaciones[index] = habitacion;
            } else {
                habitaciones.push(habitacion);
            }

            document.getElementById('habitacion-modal').style.display = 'none';
            llenarTablaHabitaciones();
            actualizarDashboard();
        }

        function editarHabitacion(numero) {
            const habitacion = habitaciones.find(h => h.numero == numero);
            if (habitacion) {
                mostrarFormularioHabitacion(habitacion);
            }
        }

        function eliminarHabitacion(numero) {
            if (confirm('¿Estás seguro de que quieres eliminar esta habitación?')) {
                habitaciones = habitaciones.filter(h => h.numero != numero);
                llenarTablaHabitaciones();
                actualizarDashboard();
            }
        }

        // Eventos para los botones de acción rápida
        document.getElementById('nueva-reserva').addEventListener('click', () => mostrarFormularioReserva());
        document.getElementById('nueva-habitacion').addEventListener('click', () => mostrarFormularioHabitacion());

        // Cerrar modales
        document.querySelectorAll('.close').forEach(closeBtn => {
            closeBtn.addEventListener('click', () => {
                closeBtn.closest('.modal').style.display = 'none';
            });
        });

        // Eventos de formularios
        document.getElementById('reserva-form').addEventListener('submit', guardarReserva);
        document.getElementById('habitacion-form').addEventListener('submit', guardarHabitacion);

        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            llenarTablaReservas();
            llenarTablaHabitaciones();
            actualizarDashboard();
        });
    </script>
</body>
</html>